<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Request Buku - Perpustakaan MTsN 7 Banjar</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="library-wrapper">

  <div class="lib-overlay" id="libOverlay" onclick="closeLibSidebar()"></div>

  <aside class="lib-sidebar" id="libSidebar">
    <div class="lib-sidebar-header">
      <a href="perpustakaan.html" class="lib-sidebar-logo">
        <div class="lib-sidebar-logo-icon">
        <img src="img/logo.png" alt="Logo MTsN 7 Banjar">
        </div>
        <div>
          <p style="font-size:.875rem;font-weight:700;color:var(--color-slate-800);line-height:1.2;margin:0">Perpustakaan</p>
          <p style="font-size:.75rem;color:var(--color-sky-500);margin:0">MTsN 7 Banjar</p>
        </div>
      </a>
    </div>
    <nav class="lib-sidebar-nav">
      <span class="lib-sidebar-nav-label">Menu Utama</span>
      <ul class="lib-nav-list">
        <li><a href="perpustakaan.html" class="lib-sidebar-link">
          <svg class="lib-sidebar-link-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          Beranda
        </a></li>
        <li><a href="katalog-kelas.html" class="lib-sidebar-link">
          <svg class="lib-sidebar-link-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/><polyline points="10 2 10 10 13 7 16 10 16 2"/></svg>
          Katalog Kelas
        </a></li>
        <li><a href="buku-nonteks.html" class="lib-sidebar-link">
          <svg class="lib-sidebar-link-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
          Buku Non-Teks
        </a></li>
        <li><a href="request-buku.html" class="lib-sidebar-link active">
          <svg class="lib-sidebar-link-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="16"/><line x1="8" x2="16" y1="12" y2="12"/></svg>
          Request Buku <span class="lib-sidebar-link-dot"></span>
        </a></li>
      </ul>
      <hr class="lib-sidebar-divider">
      <a href="index.html" class="lib-sidebar-link" style="color:var(--color-slate-500)">
        <svg class="lib-sidebar-link-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
        Kembali ke Website
      </a>
    </nav>
    <div class="lib-sidebar-footer">
      <div class="lib-sidebar-help-card">
        <p style="font-size:.75rem;font-weight:600;color:var(--color-slate-700);margin:0 0 .25rem">Butuh bantuan?</p>
        <p style="font-size:.75rem;color:var(--color-slate-500);margin:0 0 .5rem">Hubungi petugas perpustakaan kami</p>
        <a href="tel:02112345678" style="font-size:.75rem;color:var(--color-sky-600);font-weight:600">(021) 1234-5678</a>
      </div>
    </div>
  </aside>

  <div class="lib-main">
    <header class="lib-topbar">
      <button class="lib-menu-btn" onclick="toggleLibSidebar()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="18" y2="18"/></svg>
      </button>
      <div class="lib-search">
        <svg class="lib-search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
        <input type="text" placeholder="Cari buku, judul, penulis...">
      </div>
      <div class="lib-topbar-actions">
        <!-- <button class="lib-notif-btn">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>
          <span class="lib-notif-dot"></span>
        </button> -->
        <!-- <button class="lib-profile-btn">
          <div class="lib-profile-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
          </div>
          <span class="lib-profile-name">Siswa</span>
        </button> -->
      </div>
    </header>

    <main class="lib-content" style="background:linear-gradient(135deg,var(--color-sky-50),white,var(--color-amber-50))">
      <div style="max-width:42rem;margin:0 auto">

        <!-- Back -->
        <a href="perpustakaan.html" style="display:inline-flex;align-items:center;gap:.5rem;color:var(--color-slate-500);font-size:.875rem;text-decoration:none;margin-bottom:1.5rem;transition:color .2s" class="anim-slide-up">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>
          Kembali
        </a>

        <!-- Header -->
        <div style="text-align:center;margin-bottom:2rem" class="anim-slide-up">
          <div style="width:4rem;height:4rem;border-radius:var(--radius-2xl);background:linear-gradient(135deg,#fbbf24,#fb923c);display:flex;align-items:center;justify-content:center;margin:0 auto 1.25rem;box-shadow:0 12px 30px rgba(251,191,36,.35)">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>
          </div>
          <h1 style="font-size:1.75rem;font-weight:700;color:var(--color-slate-800);margin:0 0 .75rem">Request Buku</h1>
          <p style="color:var(--color-slate-500);max-width:24rem;margin:0 auto;line-height:1.7">Tidak menemukan buku yang kamu butuhkan? Ajukan request dan kami akan segera menyediakannya!</p>
        </div>

        <!-- Info Banner -->
        <div style="display:flex;align-items:flex-start;gap:.75rem;background:var(--color-amber-50);border:1px solid var(--color-amber-100);border-radius:var(--radius-2xl);padding:1rem;margin-bottom:1.5rem">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-amber-500)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink:0;margin-top:.125rem"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
          <div>
            <p style="font-size:.875rem;font-weight:600;color:var(--color-amber-700);margin:0 0 .25rem">Informasi</p>
            <p style="font-size:.75rem;color:var(--color-amber-600);margin:0;line-height:1.6">Request buku akan diproses dalam 3-7 hari kerja. Kami akan menghubungi kamu melalui guru kelas setelah buku tersedia.</p>
          </div>
        </div>

        <!-- Form Card -->
        <div style="background:white;border-radius:var(--radius-3xl);box-shadow:0 20px 60px rgba(0,0,0,.08);border:1px solid var(--color-slate-100);overflow:hidden">
          <div style="height:.5rem;background:linear-gradient(to right,#fbbf24,#fb923c,#f472b6)"></div>

          <form id="requestForm" onsubmit="submitForm(event)" style="padding:2rem;display:flex;flex-direction:column;gap:1.25rem">

            <!-- Nama -->
            <div class="form-group" style="margin-bottom:0">
              <label class="form-label">
                <svg class="form-label-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                Nama Lengkap <span class="form-required">*</span>
              </label>
              <input type="text" id="nama" class="form-input" placeholder="Masukkan nama lengkap kamu" oninput="clearError('nama')">
              <span class="form-error" id="errNama" style="display:none"></span>
            </div>

            <!-- Kelas -->
            <div class="form-group" style="margin-bottom:0">
              <label class="form-label">
                <svg class="form-label-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6-6 6 6"/><path d="M6 12h12"/><path d="m6 15 6 6 6-6"/></svg>
                Kelas <span class="form-required">*</span>
              </label>
              <select id="kelas" class="form-input" onchange="clearError('kelas')">
                <option value="">-- Pilih kelas --</option>
                <option>Kelas 7</option>
                <option>Kelas 8</option>
                <option>Kelas 9</option>
              </select>
              <span class="form-error" id="errKelas" style="display:none"></span>
            </div>

            <!-- Judul Buku -->
            <div class="form-group" style="margin-bottom:0">
              <label class="form-label">
                <svg class="form-label-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>
                Judul Buku <span class="form-required">*</span>
              </label>
              <input type="text" id="judulBuku" class="form-input" placeholder="Masukkan judul buku yang diinginkan" oninput="clearError('judulBuku')">
              <span class="form-error" id="errJudulBuku" style="display:none"></span>
            </div>

            <!-- Penulis (optional) -->
            <div class="form-group" style="margin-bottom:0">
              <label class="form-label">
                <svg class="form-label-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4Z"/></svg>
                Penulis / Pengarang <span style="font-size:.75rem;color:var(--color-slate-400);font-weight:400">(opsional)</span>
              </label>
              <input type="text" id="penulis" class="form-input" placeholder="Masukkan nama penulis jika diketahui">
            </div>

            <!-- Keterangan (optional) -->
            <div class="form-group" style="margin-bottom:0">
              <label class="form-label">
                <svg class="form-label-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                Keterangan Tambahan <span style="font-size:.75rem;color:var(--color-slate-400);font-weight:400">(opsional)</span>
              </label>
              <textarea id="keterangan" class="form-input" rows="3" placeholder="Tuliskan keterangan tambahan, misalnya edisi atau ISBN..."></textarea>
            </div>

            <!-- Buttons -->
            <div style="display:flex;flex-wrap:wrap;gap:.75rem;padding-top:.5rem">
              <button type="submit" id="submitBtn" style="flex:1;min-width:160px;display:flex;align-items:center;justify-content:center;gap:.5rem;padding:1rem;background:var(--color-amber-500);color:white;border:none;border-radius:var(--radius-2xl);font-size:.9375rem;font-weight:600;cursor:pointer;box-shadow:0 8px 20px rgba(251,191,36,.3);transition:all .2s;font-family:inherit">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
                Kirim Pengajuan
              </button>
              <a href="perpustakaan.html" style="padding:1rem 1.5rem;border:1px solid var(--color-slate-200);color:var(--color-slate-600);border-radius:var(--radius-2xl);font-size:.9375rem;font-weight:500;text-decoration:none;display:inline-flex;align-items:center;transition:all .2s">Batal</a>
            </div>
          </form>
        </div>

      </div>
    </main>
  </div>
</div>

<script>
function toggleLibSidebar() {
  document.getElementById('libSidebar').classList.toggle('open');
  document.getElementById('libOverlay').classList.toggle('open');
}
function closeLibSidebar() {
  document.getElementById('libSidebar').classList.remove('open');
  document.getElementById('libOverlay').classList.remove('open');
}

function clearError(field) {
  const el = document.getElementById('err' + field.charAt(0).toUpperCase() + field.slice(1));
  if (el) el.style.display = 'none';
  const input = document.getElementById(field);
  if (input) input.classList.remove('error');
}

function showError(field, msg) {
  const input = document.getElementById(field);
  const err = document.getElementById('err' + field.charAt(0).toUpperCase() + field.slice(1));
  if (input) input.classList.add('error');
  if (err) { err.textContent = 'âš  ' + msg; err.style.display = 'block'; }
}

function submitForm(e) {
  e.preventDefault();
  
  // Ambil data dari form
  const nama = document.getElementById('nama').value.trim();
  const kelas = document.getElementById('kelas').value;
  const judulBuku = document.getElementById('judulBuku').value.trim();
  const penulis = document.getElementById('penulis').value.trim();
  const keterangan = document.getElementById('keterangan').value.trim();

  // Validasi sederhana
  let valid = true;
  if (!nama) { showError('nama', 'Nama wajib diisi'); valid = false; }
  if (!kelas) { showError('kelas', 'Kelas wajib dipilih'); valid = false; }
  if (!judulBuku) { showError('judulBuku', 'Judul buku wajib diisi'); valid = false; }
  if (!valid) return;

  // Animasi Loading
  const btn = document.getElementById('submitBtn');
  btn.disabled = true;
  btn.innerHTML = '<svg class="spin" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg> Mengirim...';
  btn.style.background = 'var(--color-amber-400)';

  // --- BAGIAN PENGIRIMAN KE GOOGLE SHEETS ---
  // MASUKKAN URL WEB APP GOOGLE SCRIPT KAMU DI SINI
  const scriptURL = 'https://script.google.com/macros/s/AKfycbxdZb8PBJWAbjx129RDB1Y4CIpagnVb3uryn1fllS5dGJMZrNYca8UU8QCIkHvVbLe0EA/exec';

  // Menyiapkan data untuk dikirim (Harus cocok dengan key di Apps Script)
  const formData = new URLSearchParams();
  formData.append('nama', nama);
  formData.append('kelas', kelas);
  formData.append('judulBuku', judulBuku); // Ini pemicu agar script memilih Sheet2
  formData.append('penulis', penulis);
  formData.append('keterangan', keterangan);

  fetch(scriptURL, { 
    method: 'POST', 
    body: formData 
  })
  .then(response => {
    // Jika berhasil, simpan ke session dan pindah ke halaman konfirmasi
    sessionStorage.setItem('requestBukuData', JSON.stringify({ 
      nama, kelas, judulBuku, penulis, keterangan, 
      timestamp: new Date().toISOString() 
    }));
    window.location.href = 'konfirmasi-request.html';
  })
  .catch(error => {
    console.error('Error!', error.message);
    alert('Gagal mengirim request. Pastikan koneksi internet aktif.');
    
    // Kembalikan tombol ke keadaan semula
    btn.disabled = false;
    btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg> Kirim Pengajuan';
    btn.style.background = 'var(--color-amber-500)';
  });
}
</script>
<style>
.spin { animation: spinAnim 1s linear infinite; }
@keyframes spinAnim { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
</style>
</body>
</html>